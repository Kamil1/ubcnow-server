# API v1 Draft

This is a draft specification for version 1 of the ubcnow-server REST API.

Many things are likely to change before finalization.

## Using the API

### Encoding

All body requests and responses are encoded in JSON. The fields in the
specification for each model object directly correspond to its JSON
fields in requests and responses, unless otherwise indicated.

### Versioning

All API calls must be preceded by a version identifier:

    http://host:port/api/v1/

Alternatively, you may also request the latest API:

    http://host:port/api/latest/

All endpoints documented are expressed relative to the above URL.

### Parameters

URL parameters are expressed with :this notation.

Optional parameters are in parentheses.

## Authentication

TBD

# Data Model

## Blips

A 'blip' is a general class of event that is propagated to a [group](#Groups)'s users.

### Specification

| Field      | Type     | Description                         | Required |
| ---------- | -------- | ----------------------------------- | -------- |
| id         | Long     | A unique index generated by the DB. | true     |
| group      | Group    | The group of this blip.             | true     |
| title      | String   | A user-readable event title.        | true     |
| summary    | String   | A user-readable event summary.      | false    |
| link       | String   | A link to the event's page.         | false    |
| startTime  | String   | The start time of the event.        | false    |
| endTime    | String   | The end time of the event.          | false    |
| address    | String   | User-readable address of location.  | false    |
| lat        | Double   | Latitude of event location.         | false    |
| lng        | Double   | Longitude of event location.        | false    |


#### Example Data

TODO

## Users

TODO: (probably best to wait on auth (CWL) for this one)
=======
A 'user' is a data model representing a client, with whom blips are paired off based on
the user's intersts + group affiliations

### Specification

| Field          | Type           | Description                                                                | Required |
| -------------- | -------------- | -------------------------------------------------------------------------- | -------- | 
| puid           | Long           | A unique index generated by the univerity                                  | true     |
| studentNumber  | Long           | A university-generated student number of the user                          | false    |
| affiliation    | String         | The affiliation of the user to the university (student, employee or guest) | true     |
| firstName      | String         | The first name of the user                                                 | true     |
| lastName       | String         | The last name of the user                                                  | true     |
| interests      | List[Interest] | A list of the user's interests                                             | true     |
| groups         | List[Groups]   | A list of groups the user is subscribed to                                 | true     |



TODO: 

## Groups

A 'group' is a classification composed of users who wish to receive a certain
type of notification.

TODO: groups admin API

### Specification

| Field      | Type            | Description                                            | Required |
| ---------- | --------------- | ------------------------------------------------------ | -------- |
| id         | Long            | Group identifier                                       | true     |
| name       | String          | A user-readable group name                             | true     |
| interests  | List[Long]      | A list of interest IDs the group relates to.           | true     |
| concrete   | Boolean         | True if this is a concrete group                       | true     |


#### Example Data

TODO

### Examples

A concrete group would be the UBC math club.

An abstract group would be a "bus notifications" group.

## Interest

An interest is a classification indicated by individual users. Interests are paired with 
groups to identify potential Blips of interest.

### Specification

| Field      | Type          | Description                                             | Required |
| ---------- | ------------- | ------------------------------------------------------- | -------- |
| id         | Long          | Interest identifier                                     | true     |
| name       | String        | User-readable name of this interest                     | true     |

### Example Data

TODO

# Endpoints

Note that all HTTP body responses are encoded in JSON.

## Blips

| Path | Method | Notes | Request | Response |
| ---- | ------ | ------| ------- | -------- |
| /blip       | GET    | Receives a list of the user's current blips. | N/A | List[Blip] |
| /blip       | POST   | Creates a new blip with the JSON data in the request's body. | Blip | N/A |
| /blip/:id   | GET    | Retrieves the blip with the given id. | N/A | Blip |
| /blip/:id   | PUT    | Updates the blip's fields with the JSON data in the request's body. TODO: authenticate. | Blip | N/A |
| /blip/:id   | DELETE | Deletes the blip with the given id. | N/A | N/A |

### Examples

TODO

## Groups

| Path | Method | Notes | Request | Response |
| ---- | ------ | ----- | ------- | -------- |
| /group | GET | Retrieves a list of the user's groups. | N/A | List[Group] |
| /group | POST | Creates a new group. | Group | N/A |
| /group/:id | GET | Retrieves the group with the given id. | N/A | Group |
| /group/:id | PUT | Updates a group. | Group | N/A |
| /group/:id | DELETE | Deletes a group. | N/A | N/A |
| /group/:id/blips | GET | Retrieves a list of blips belonging to the group, recent first. | count: Int, after: Blip.id | List[Blip] |
| /group/search | GET | Finds groups with the given query string. | query: String | List[Group] |

### Examples

TODO

# Blip Stream

Endpoint:

    /blip/stream

ubcnow-server can communicate real-time events to clients connected using unidirectional WebSockets.

JSON blobs representing 'updates' are sent over the WebSocket stream.

## Update Specification

This specification corresponds to JSON fields in the messages sent via WebSocket.

| Field | Type | Description |
| ----- | ---- | ----------- |
| type  | enum { add, update, delete }| Denotes the type of update. |
| id | Long | The blip being added, updated, or deleted.
